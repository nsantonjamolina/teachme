<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-indigo.min.css" />
		<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>	
		<link rel="stylesheet" href="styles/timetablejs.css">
		<link rel="stylesheet" href="style.css">
		<script src="moment.js"></script> 
		<!--script src="combodate.js"></script--> 
	</head>
<body>
	
<!--Modal confirmación-->
	
<dialog id="profesorRegistrado" class="mdl-dialog">
   <h4 class="mdl-dialog__title">¡Listo!</h4>
   <div class="mdl-dialog__content">
	   <p id="loginError"></p>
	   
	   <!-- Simple Textfield -->

  <div class="mdl-textfield mdl-js-textfield">
	  <h5>Se ha dado de alta correctamente!</h5>
  </div>

	   <!-- Simple Textfield -->

  <div class="mdl-textfield mdl-js-textfield">
    
  </div>

   </div>
   <div class="mdl-dialog__actions">
       <!-- Colored raised button -->
		<button id="profesorRegistradoButton" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
			Volver</button>
	</div>
</dialog>	
	
<!--Main page -->		
<div class="mdl-layout mdl-js-layout">
   <header class="mdl-layout__header">
      <div class="mdl-layout-icon"></div>
      <div class="mdl-layout__header-row">
         <span class="mdl-layout__title">Teach me</span>
         <span class="extraspace"> | </span>
         <span class="extraspace" onclick="location.href='index.html';"> Home </span>
         
         <div class="mdl-layout-spacer"></div>
         <nav class="mdl-navigation">
			 
            <!-- Accent-colored raised button -->
            <span class="extraspace"> </span>
            <button id="logginButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            Iniciar sesión
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
            <!-- Accent-colored raised button -->
            <span class="extraspace"> </span>
            
            <button id="intranetButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="location.href='areaAlumno.html';">
            Intranet
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
            
            <span class="extraspace"> </span> 
            <!-- Accent-colored raised button -->
            <span class="extraspace"> </span>
            
            <button id="profesorButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="location.href='areaProfesor.html';">
            Hazte profesor
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
            
            <span class="extraspace"> </span> 
            <!-- Accent-colored raised button -->
            <span class="extraspace"> </span>
            
            <button id="areaProfesorButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="location.href='intranetProfesor.html';">
            Área profesor
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
            
            <span class="extraspace"> </span> 
            <!-- Accent-colored raised button -->	
            <button id="logoutButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            Cerrar sesión
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
         
         	<span class="extraspace"> </span> 
         	<!-- Accent-colored raised button -->	
         	<button id="registrateButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
         	Regístrate
         	<i class="button-righ-icon material-icons">account_circle</i>
         	</button>
         </nav>
      </div>
   </header>
</div>	
<div id="div1ClasesAlumno">
	<h5>Conoce a tu profesor</h5>
	<h6>Revisa el calendario, elige un fecha y haz click en guardar</h6>
</div>

<div id="div2ClasesAlumno">
	<table id="tablaContrataClase2" class="mdl-data-table mdl-js-data-table">
  		<thead>
			<tr>
      			<th class="mdl-data-table__cell--non-numeric" style="text-align: center;">Nombre</th>
      			<th class="mdl-data-table__cell--non-numeric" style="text-align: center;">Te voy a enseñar</th>
      			<th class="mdl-data-table__cell--non-numeric" style="text-align: center;">Language</th>
				<th class="mdl-data-table__cell--non-numeric" style="text-align: center;">Video</th>
    		</tr>
  		</thead>
  		<tbody>
			<tr>
				<td id=nameProf class="mdl-data-table__cell--non-numeric" style="text-align: center;"><h6></h6></td>
      			<td id="teachProf" class="mdl-data-table__cell--non-numeric" style="text-align: center;"></td>
      			<td id="langProf" class="mdl-data-table__cell--non-numeric"></td>
				<td  id="video" class="mdl-data-table__cell--non-numeric">
					<!--iframe width="560" height="315" src="https://www.youtube.com/embed/yUzdZ4hAFBs" frameborder="0" allowfullscreen></iframe-->
    		</tr>
  		</tbody>
	</table>
</div>
	
<div id="divClasesAlumnoG">
	
	<!-- Accent-colored raised button with ripple -->
	<button id="2" onclick=user(); class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
  		Guardar
	</button>
	<span></span>
	<button id="3" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
  		Volver
	</button>
</div>	
	
<div id="divClasesAlumnoTT" class="timetable"></div>		
<span></span>

</body>

	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
	<script>
  	// Initialize Firebase
  		var config = {
    		apiKey: "AIzaSyCr2wfyL15rtEmQJsy-mGuc3URImSdNraQ",
    		authDomain: "teachme-7ed11.firebaseapp.com",
    		databaseURL: "https://teachme-7ed11.firebaseio.com",
    		projectId: "teachme-7ed11",
    		storageBucket: "teachme-7ed11.appspot.com",
    		messagingSenderId: "147010117223"
  		};
  		firebase.initializeApp(config);
	</script>

	<script src="scripts/timetable.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type='text/javascript' src="functions.js"></script>		
	<script>
		// Nos pasan el id en la url, parseamos y hacemos retrieve de esa info en fb
		var url = window.location.href;
		var search = url.split("?");
		var searchfb = search[1].slice(3);
		firebase.database().ref('/prof/' + searchfb).once('value').then(function(snapshot) {
  			var lang = snapshot.val().lang;
			var name = capitalizeFirstLetter(snapshot.val().name);
			var teach = capitalizeFirstLetter(snapshot.val().teach);
			var videourl = snapshot.val().videourl;
			var videourl2 = "<iframe width='350' height='315' src="+videourl+" frameborder='0' gesture='media' allowfullscreen></iframe>";
		 	
					
		document.getElementById("nameProf").innerHTML = name;
		document.getElementById("langProf").innerHTML = lang;
		document.getElementById("teachProf").innerHTML = teach;
		document.getElementById("video").innerHTML = videourl2;
		});
		
		function capitalizeFirstLetter(string) {
    		return string.charAt(0).toUpperCase() + string.slice(1);
		}
	</script>
	
	<script>
		var timetable = new Timetable();
		timetable.setScope(9,15);
		timetable.addLocations(['Lunes 1', 'Martes 2', 'Miércoles 3', 'Jueves 4', 'Viernes 5', 'Sábado 6', 'Domingo 7']);
		// Añadimos a la tabla
		//timetable.addEvent('Ocupado',dia, new Date(2017,8,19,inicio,00), new Date(2017,8,19,fin,00));
		timetable.addEvent('Libre', 'Lunes 1', new Date(2015,7,17,9,30), new Date(2015,7,17,10,30));
		timetable.addEvent('Libre', 'Lunes 1', new Date(2015,7,17,10,30), new Date(2015,7,17,11,30));
		timetable.addEvent('Ocupado', 'Lunes 1', new Date(2015,7,17,11,30), new Date(2015,7,17,12,30));
		timetable.addEvent('Libre', 'Lunes 1', new Date(2015,7,17,12,30), new Date(2015,7,17,13,30));
		timetable.addEvent('Libre', 'Martes 2', new Date(2015,7,17,9,30), new Date(2015,7,17,10,30));
		timetable.addEvent('Libre', 'Martes 2', new Date(2015,7,17,10,30), new Date(2015,7,17,11,30));
		timetable.addEvent('Ocupado', 'Martes 2', new Date(2015,7,17,11,30), new Date(2015,7,17,12,30));
		timetable.addEvent('Libre', 'Martes 2', new Date(2015,7,17,12,30), new Date(2015,7,17,13,30));
		timetable.addEvent('Libre', 'Miércoles 3', new Date(2015,7,17,9,30), new Date(2015,7,17,10,30));
		timetable.addEvent('Ocupado', 'Miércoles 3', new Date(2015,7,17,10,30), new Date(2015,7,17,11,30));
		timetable.addEvent('Libre', 'Miércoles 3', new Date(2015,7,17,11,30), new Date(2015,7,17,12,30));
		timetable.addEvent('Libre', 'Miércoles 3', new Date(2015,7,17,12,30), new Date(2015,7,17,13,30));
		timetable.addEvent('Libre', 'Jueves 4', new Date(2015,7,17,9,30), new Date(2015,7,17,10,30));
		timetable.addEvent('Libre', 'Jueves 4', new Date(2015,7,17,10,30), new Date(2015,7,17,11,30));
		timetable.addEvent('Ocupado', 'Jueves 4', new Date(2015,7,17,11,30), new Date(2015,7,17,12,30));
		timetable.addEvent('Libre', 'Jueves 4', new Date(2015,7,17,12,30), new Date(2015,7,17,13,30));	
		timetable.addEvent('Libre', 'Viernes 5', new Date(2015,7,17,9,30), new Date(2015,7,17,10,30));
		timetable.addEvent('Libre', 'Viernes 5', new Date(2015,7,17,10,30), new Date(2015,7,17,11,30));
		timetable.addEvent('Ocupado', 'Viernes 5', new Date(2015,7,17,11,30), new Date(2015,7,17,12,30));
		timetable.addEvent('Libre', 'Viernes 5', new Date(2015,7,17,12,30), new Date(2015,7,17,13,30));
		var renderer = new Timetable.Renderer(timetable);
		renderer.draw('.timetable');
				
		
		
		
	</script>
	<!--script>

		// Obtenemos id del profesor
			var url = window.location.href;
			var search = url.split("?");
			var idProfesor = search[1].slice(3);
		console.log(idProfesor);
		
		// Función para guardar la clase 
		function getEventFromDB(idProfesor){
			var ref = firebase.database().ref('clases/' + idProfesor); 
			ref.once('value').then(function(snapshot) {
				snapshot.forEach(function(childSnapshot) {
      		// Traigo snapshot y le saco los datos
      		// childData will be the actual contents of the child
      			var location = childSnapshot.val().location;
				var inicio = childSnapshot.val().inicio;
				var final = childSnapshot.val().final;
					
				//timetable.addEvent('Ocupado',location, new Date(2017,8,19,inicio,00), new Date(2017,8,19,final,00));	
  				//var param = "'Ocupado',Lunes, new Date(2017,8,19,10,00), new Date(2017,8,19,11,00)";
				timetable.addEvent(param);
				renderer.draw('.timetable');
				})
				
		})
		}
		
		/*
		// Función para traer la info que hay en BD
		function addEventFromHTML (dia, horai, minutosi, horaf, minutosf){
			
			var month = Date.now().getMonth();
			Date date = new Date("2017", month, "1", "1", "1");
			
			console.log(date.toDateString);
			
			var postData = "hola";
			var currentUser = firebase.auth().currentUser;
			var uuid = currentUser.uid;
			
			// Añadimos a BD clases
			var ref = firebase.database().ref();	
	
				
			console.log(uuid);
			
			
			// Get a key for a new Post.
  			var newPostKey = firebase.database().ref().child('/clases/' + idProfesor).push().key;
  			// Write the new post's data simultaneously in the posts list and the user's post list.
  			var updates = {};
  			updates['clases/' + idProfesor +'/'+ newPostKey] = postData;
  			updates['alumno/' + uuid + '/' + newPostKey] = postData;

  			return firebase.database().ref().update(updates);	
			
			// Añadimos a la tabla
			timetable.addEvent('Ocupado',dia, new Date(2017,8,19,inicio,00), new Date(2017,8,19,fin,00));
			renderer.draw('.timetable');
		}
		*/
		
      	var timetable = new Timetable();
		
		
		
		timetable.setScope(9,15);
      	
		timetable.addLocations(['Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado', 'Domingo']);
		
	//	getEventFromDB(idProfesor);
		
		//var param = "'Ocupado',Lunes, new Date(2017,8,19,10,00), new Date(2017,8,19,11,00)";
				timetable.addEvent('Ocupado','Lunes', new Date(2017,8,19,10,00), new Date(2017,8,19,11,00));
				
		
		var renderer = new Timetable.Renderer(timetable);
		
		renderer.draw('.timetable');
  
    </script>
	<!--script>
		$(function() {
    		$( "#datepicker" ).datepicker();
		});
	</script-->
	
	<!--script>
		window.onload = function() {
    		var user = firebase.auth().currentUser;
			if (user !== null){	
			console.log("Desde profesor te digo1:" + user.email);
			console.log("Desde profesor te digo2:" + user.displayName);
			//  		initApp();
			}
		};
		
	</script-->
<script>
		var url = window.location.href;
		var search = url.split("?");
		var profesorIdUrl = search[1].slice(3);
		
		function user(){
		
		
		var user = firebase.auth().currentUser;
		
		if (user !== null) {
			console.log("Desde prof: "+ user.uid);
			addClass(user.uid, profesorIdUrl,document.getElementById("1").value);
		/* Guardar en clases: 
			- id sesión 
			- id alumno 
			- id prof
			- id 1
		
		*/
			
			
		} else {			
			console.log("Sorry, no hay user");	
		}};

	/* ADD A CLASS  */

function addClass (alumnoId, profesorId, fecha) {
		
	// A post entry.
  	var postData = {
	alumnoId : alumnoId,
	profesorId : profesorId,
	fecha : fecha,	
	realizada: 0	
  	};
	
  	// Get a key for a new Post.
  	var newPostKey = firebase.database().ref().child('clases').push().key;

	console.log("newPostKey "+newPostKey);	

  // Write the new post's data simultaneously in the posts list and the user's post list.
  	var updates = {};
  	updates['/clases/' + newPostKey] = postData;

  	//firebase.database().ref().update(updates).then(function(){}
	firebase.database().ref().update(updates);	 
	
	var dialog = document.querySelector('#profesorRegistrado');
  		if (! dialog.showModal) {
      		dialogPolyfill.registerDialog(dialog);
    	}
		dialog.showModal();
};

$("#profesorRegistradoButton").click(function(){
		var dialog = document.querySelector('#profesorRegistrado');
  		if (! dialog.showModal) {
      		dialogPolyfill.registerDialog(dialog);
    	}
		dialog.close();
})

</script>

</html>	