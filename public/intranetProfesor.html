<!DOCTYPE html>
<html>
	<head>
		<title>Teach me</title>
		<meta charset="UTF-8">
		<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
		<link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.blue-indigo.min.css" />
		<script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>	
		<link rel="stylesheet" href="style.css">
	</head>
<body>
	
	
<!--Modify prof data dialog -->		
		
<dialog id="editProfData" class="mdl-dialog">
   <h7 class="mdl-dialog__title">Edita tus datos</h7>
   <div class="mdl-dialog__content">
	   
	   
	   <!-- Simple Textfield -->

  <div class="mdl-textfield mdl-js-textfield">
	
	 
    <input class="mdl-textfield__input" type="text" id="editaMateria">
    <label id="etiquetaEdita" class="mdl-textfield__label" ></label>
  </div>

<div class="mdl-textfield mdl-js-textfield">
	
    <input class="mdl-textfield__input" type="text" id="editaMateria2">
    <label id="etiquetaEdita2" class="mdl-textfield__label" ></label>
  </div>
	   
	   
   </div>
   <div class="mdl-dialog__actions">
       <!-- Colored raised button -->
		<button id="editaGuardarButton" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
			Guardar</button>
	</div>
</dialog>

	
<!--Main page -->		
		
<div class="mdl-layout mdl-js-layout">
   <header class="mdl-layout__header">
      <div class="mdl-layout-icon"></div>
      <div class="mdl-layout__header-row">
         <span class="mdl-layout__title">Teach me</span>
         <span class="extraspace"> | </span>
         <span class="extraspace" onclick="location.href='index.html';"> Home </span>
         <div class="mdl-layout-spacer"></div>
         <nav class="mdl-navigation">
			
			 <!-- Accent-colored raised button -->
			<span class="extraspace"> </span>
            <button id="logginButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            Login
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
			<span class="extraspace"> </span> 
			 
            <!-- Accent-colored raised button -->
			 <span class="extraspace"> </span>
            	
			 	<button id="profesorButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" onclick="location.href='areaProfesor.html';">
				Hazte profesor!
            		<i class="button-righ-icon material-icons">account_circle</i>
            	</button>
					
			<span class="extraspace"> </span> 
			
			 <!-- Accent-colored raised button -->	
            <button id="logoutButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            Sign out
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
         
		  
		  <span class="extraspace"> </span> 
			
			 <!-- Accent-colored raised button -->	
            <button id="registrateButton" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">
            Regístrate
            <i class="button-righ-icon material-icons">account_circle</i>
            </button>
         </nav>
      </div>
   </header>
   
   
</div>

<div id="div1ClasesAlumno">
	<h4>Datos del profesor</h4>
	<button id="editaProf" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" style="font-size:14px;">Edita tus datos</button>
	<button id="borraProf" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" style="font-size:14px;">Borra tu cuenta</button>
</div>	
	
<div id="div2ClasesAlumno">
	<h4>Tu valoración actual es: 4/5</h4>
	<!--img src = "4sobre5.png"-->
</div>
	
<div id="div3IntranetProfesor">
	<h4>Solicitudes</h4>
	<table  class="mdl-data-table mdl-js-data-table">
  		<thead>
			<tr>
      			<th class="mdl-data-table__cell--non-numeric">Fecha</th>
      			<th class="mdl-data-table__cell--non-numeric">Materia</th>
				<th class="mdl-data-table__cell--non-numeric">Aceptar</th>
				<th class="mdl-data-table__cell--non-numeric">Rechazar</th>
    		</tr>
  		</thead>
  		<tbody id="solicitudes">
  		</tbody>
	</table>
	
</div>	
	
<div id="div4IntranetProfesor">
	<h4>Próximas clases </h4>
	<table  class="mdl-data-table mdl-js-data-table">
  		<thead>
			<tr>
      			<th class="mdl-data-table__cell--non-numeric">Fecha</th>
      			<th class="mdl-data-table__cell--non-numeric">Teach</th>
				<th class="mdl-data-table__cell--non-numeric">Idioma</th>
				<th class="mdl-data-table__cell--non-numeric">Nombre alumno</th>
    		</tr>
  		</thead>
  		<tbody id="proxClas">
  		</tbody>
	</table>
</div>

	
	<script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script type='text/javascript' src="functions.js"></script>
	
	<script>
  	// Initialize Firebase
  		var config = {
    		apiKey: "AIzaSyCr2wfyL15rtEmQJsy-mGuc3URImSdNraQ",
    		authDomain: "teachme-7ed11.firebaseapp.com",
    		databaseURL: "https://teachme-7ed11.firebaseio.com",
    		projectId: "teachme-7ed11",
    		storageBucket: "teachme-7ed11.appspot.com",
    		messagingSenderId: "147010117223"
  		};
  		firebase.initializeApp(config);
	</script>
	
			
	<script>
	// Necesito que de alguna manera me pasen el id en la URL
	// Lo ideal, sólo en caso de que esté logueado
		
	var url = window.location.href;
	var search = url.split("?");
	//var idProfesor = search[1].slice(3);
	var idProfesor = "-Ksc33aYghNv6TeTw6td";
			
$("#borraProf").click(function(){
	var refBorrar = firebase.database().ref('prof/' + idProfesor);
	refBorrar.remove().then(function() {
    console.log("Remove succeeded")}).catch(function(error) {
    console.log("Remove failed: " + error.message)});
});
	
	// Dialogo de edición de datos del profesor
		
$("#editaProf").click(function(){
	// Recupero la info del profesor
	var ref = firebase.database().ref();
	var materia;
	var precio;
	ref.once("value").then(function(snapshot){
		materia = snapshot.child('prof/' + idProfesor+'/teach').val();
		precio = snapshot.child('prof/' + idProfesor+'/precio').val();
		console.log(materia);
		
		document.getElementById('etiquetaEdita').innerHTML = "Materia: "+materia;
		document.getElementById('etiquetaEdita2').innerHTML = "Precio: "+precio;
		
		var dialog = document.querySelector('#editProfData');
  		if (! dialog.showModal) {
      		dialogPolyfill.registerDialog(dialog);
    	}
			
		dialog.showModal();
	});
	
$("#editaGuardarButton").click(function(){
	var newMateria = document.getElementById('editaMateria').value;
	var newPrecio = document.getElementById('editaMateria2').value;
	var rutaMateriaRef = "prof/"+idProfesor+"/materia";
	var rutaPrecioRef = "prof/"+idProfesor+"/precio";
	var materiaRef = firebase.database().ref(rutaMateriaRef);
	materiaRef.set(newMateria);
	var precioRef = firebase.database().ref(rutaPrecioRef);
	precioRef.set(newPrecio).then(function() {
    console.log('Synchronization succeeded');
  	}).catch(function(error) {
    console.log('Synchronization failed');
  	});;
	});	
		
				
	
		//document.getElementById("editaMateria").value = materia;
  
});		
		
</script>
<script>
	$(document).ready(function(){
				
			var user = firebase.auth().currentUser;
			var clases = ["GHGHGH","-Kyz3LqCQskBkVtKsN5S"];
			var aceptadas = ["DHDHDH","-KxwKIH8zdQd_yL98Djb"]
		
		
			
			var ref = firebase.database().ref();
			ref.once("value").then(function(snapshot){
				
				while (clases.length){
					
						idClase = clases.pop();
						
						
						var materia = snapshot.child('clases/'+idClase+'/materia').val();
						var fecha = snapshot.child('clases/'+idClase+'/fecha').val();
						
				
					
							
						$("#solicitudes").append("<tr><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><h6>"+fecha+"</h6></td><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><h6>"+materia+"</h6><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><button class='mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent'>Aceptar</button></td><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><button class='mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent'>Rechazar</button></td></tr>");
					
					
		};
		});
		
		var ref = firebase.database().ref();
			ref.once("value").then(function(snapshot){
				
				while (aceptadas.length){
					
						idClase = aceptadas.pop();
						
						
						var materia = snapshot.child('clases/'+idClase+'/materia').val();
						var fecha = snapshot.child('clases/'+idClase+'/fecha').val();
						var idioma = snapshot.child('clases/'+idClase+'/idioma').val();
						var nombreAlu = snapshot.child('clases/'+idClase+'/nombreAlu').val();
						
					
					$("#proxClas").append("<tr><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><h6>"+fecha+"</h6></td><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><h6>"+materia+"</h6></td><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><h6>"+idioma+"</h6></td><td class='mdl-data-table__cell--non-numeric' style='text-align: center;'><h6>"+nombreAlu+"</h6></td></tr>");
					
					
		};
		});
	});
	
</script>	
</body>
</html>